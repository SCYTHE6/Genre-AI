(()=>{var e={};e.id=250,e.ids=[250],e.modules={70:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>k,routeModule:()=>$,serverHooks:()=>v,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>b});var t={};s.r(t),s.d(t,{POST:()=>x,config:()=>w,maxDuration:()=>h});var o=s(6559),a=s(8088),i=s(7719),n=s(2190);let c=require("fs/promises");var l=s(3873),u=s.n(l);let p=require("child_process"),f=require("util"),m=require("fs");var d=s.n(m);let g=(0,f.promisify)(p.exec),h=1800;async function x(e){console.log("Transform API endpoint hit");try{let r=await e.formData(),s=r.get("audioFile"),t=r.get("genre");if(console.log("Processing file:",s?.name,"for genre:",t),!s||!t)return n.NextResponse.json({error:"Missing required fields"},{status:400});let o=u().join(process.cwd(),"public","uploads"),a=u().join(process.cwd(),"public","transformed");try{d().existsSync(o)||await (0,c.mkdir)(o,{recursive:!0}),d().existsSync(a)||await (0,c.mkdir)(a,{recursive:!0})}catch(e){console.error("Error creating directories:",e)}let i=Buffer.from(await s.arrayBuffer()),l=s.name.replace(/\s+/g,"_"),p=Date.now(),f=u().join(o,`${p}_${l}`);await (0,c.writeFile)(f,i),console.log("Original file saved at:",f);let m=u().extname(l),h=`${u().basename(l,m)}_${t}${m}`,x=u().join(a,`${p}_${h}`),w=u().join(process.cwd(),"ml_scripts","run_spleeter.bat"),$=u().join(process.cwd(),"ml_scripts","spleeter_transform.py"),y=!1;if(d().existsSync(w)&&d().existsSync($))try{console.log("Starting ML transformation using Spleeter..."),console.log(`Running: ${w} ${$} "${f}" "${x}" "${t}"`);let{stdout:e,stderr:r}=await g(`"${w}" "${$}" "${f}" "${x}" "${t}"`);if(console.log("Transformation stdout:",e),r&&console.error("Transformation stderr:",r),d().existsSync(x)){let e=d().statSync(f),r=d().statSync(x);e.size!==r.size?console.log("Transformation successful! File sizes differ."):console.log("Warning: Transformed file has same size as original."),y=!0}}catch(e){console.error("Error executing ML script:",e)}if(!y){console.log("ML transformation failed, applying basic audio effects...");try{await g("ffmpeg -version");let e="";switch(t.toLowerCase()){case"rock":e=`ffmpeg -i "${f}" -af "volume=1.5,bass=g=5,treble=g=2,acompressor=threshold=0.1:ratio=3:attack=0.1:release=0.2" "${x}"`;break;case"jazz":e=`ffmpeg -i "${f}" -af "volume=1.2,bass=g=3,treble=g=-1,acompressor=threshold=0.3:ratio=2" "${x}"`;break;case"electronic":e=`ffmpeg -i "${f}" -af "volume=1.3,aecho=0.8:0.7:40:0.5,highpass=f=200,treble=g=4" "${x}"`;break;case"classical":e=`ffmpeg -i "${f}" -af "volume=1.1,aecho=0.9:0.9:1000:0.3,acompressor=threshold=0.5:ratio=2" "${x}"`;break;default:e=`ffmpeg -i "${f}" -af "volume=1.2,bass=g=2,treble=g=2" "${x}"`}console.log("Running ffmpeg command:",e),await new Promise(e=>setTimeout(e,2e3));let{stdout:r,stderr:s}=await g(e);console.log("ffmpeg stdout:",r),s&&console.log("ffmpeg stderr:",s),y=d().existsSync(x)}catch(e){console.error("Error using ffmpeg:",e),console.log("Falling back to basic file copy with a delay"),await new Promise(e=>setTimeout(e,2e3)),await (0,c.writeFile)(x,i)}}let b=`/transformed/${p}_${h}`;return console.log("Transformation complete, returning path:",b),n.NextResponse.json({success:!0,message:y?"Audio transformed successfully":"Audio processed with basic effects",transformedFilePath:b})}catch(e){return console.error("API error:",e),n.NextResponse.json({error:"Failed to process the audio file",details:String(e)},{status:500})}}let w={api:{bodyParser:!1}},$=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/transform/route",pathname:"/api/transform",filename:"route",bundlePath:"app/api/transform/route"},resolvedPagePath:"C:\\Github\\Genre-AI\\app\\api\\transform\\route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:y,workUnitAsyncStorage:b,serverHooks:v}=$;function k(){return(0,i.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:b})}},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[447,580],()=>s(70));module.exports=t})();